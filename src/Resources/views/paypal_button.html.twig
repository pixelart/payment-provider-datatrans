<script src="{{ script }}" type="text/javascript"></script>

<div id="paypalbutton" style="width: 400px; margin: 100px auto;"></div>

<form id="paypal_form" method="POST">
    <input type="hidden" id="paypal_transactionId" name="uppTransactionId" value="" />
</form>

<script type="text/javascript">
    PayPalButton.init({
        merchantId: '{{ merchant_id }}', // @todo set real merchant ID from yaml config or builder
        currencyCode: '{{ currency }}',
        amount: "{{ total }}",
        autoSettle: true,
        createAlias: false,
        reqType: 'CAA'
    });

    const configuration = {
        paypaloptions: {
            button: {
                layout: 'vertical',
                color: 'blue',
                shape: 'rect',
                label: 'paypal'
            }
        },
        transaction: {
            refno: "{{ refno }}",
            authenticationOnly: false,
            returnAddress: false
        }
    }

    PayPalButton.on("init", function () {
        PayPalButton.create(document.getElementById('paypalbutton'), configuration)
    });

    PayPalButton.on("authorization", function (data) {
        // handle transaction result
        if (data.status === 'success') {
            console.log("authorized", data.transactionId);
            document.getElementById('paypal_transactionId').value = data.transactionId;
            document.getElementById('paypal_form').submit();
        }
    });
</script>